@using Microsoft.AspNet.Identity
@using LKaifer_BugTracker.Models
@using LKaifer_BugTracker.Helpers
@{
    ViewBag.Title = "Dashboard";
    List<Project> ProjectList = ViewBag.AllProjectList as List<Project>;
    ApplicationDbContext db = new ApplicationDbContext();
    UserRolesHelper helper = new UserRolesHelper();
    ProjectsHelper projectshelper = new ProjectsHelper();
    NotificationHelper notificationHelper = new NotificationHelper();
    ApplicationUser currentUser = db.Users.Find(User.Identity.GetUserId());
    var currentRole = helper.ListUserRoles(User.Identity.GetUserId()).FirstOrDefault();
    var assignedDevTickets = db.Tickets.Where(t => t.AssignedToUserId.Equals(currentUser.Id)).ToList();
    var assignedSubTickets = db.Tickets.Where(t => t.OwnerUserId.Equals(currentUser.Id)).ToList();
    var ownedTickets = db.Tickets.Where(t => t.OwnerUserId.Equals(currentUser.Id)).ToList();
    var allTickets = db.Tickets.ToList();
    var unassignedTickets = db.Tickets.Where(t => t.AssignedToUser.Equals(null)).ToList();
   

}


<!-- //w3_agileits_top_nav-->
<!-- /inner_content-->
@*<div class="inner_content">*@
    <!-- /inner_content_w3_agile_info-->
    @*<div class="inner_content_w3_agile_info">*@
        <!-- /agile_top_w3_grids-->
        @*<div class="agile_top_w3_grids">*@
    <ul class="ca-menu">

        @if (User.IsInRole("Admin") || User.IsInRole("Manager"))
        {
            <li>
                <a href="@Url.Action("MyIndex", "Tickets")">
                    <i class="fa fa-building-o" aria-hidden="true"></i>
                    <div class="ca-content">
                        <h4 class="ca-main one">@unassignedTickets.Count</h4>
                        <h3 class="ca-sub">Unassigned Tickets</h3>
                        <h3 class="ca-main one"></h3>
                    </div>
                </a>

            </li>
        }

        @if (User.IsInRole("Developer"))
        {
            <li>
                <a href="@Url.Action("MyIndex", "Tickets")">
                    <i class="fa fa-building-o" aria-hidden="true"></i>
                    <div class="ca-content">
                        <h4 class="ca-main one">@assignedDevTickets.Count</h4>
                        <h3 class="ca-sub">My Tickets</h3>
                        <h3 class="ca-main one"></h3>
                    </div>
                </a>

            </li>
        }

        @if (User.IsInRole("Submitter"))
        {
            <li>
                <a href="@Url.Action("MyIndex", "Tickets")">
                    <i class="fa fa-building-o" aria-hidden="true"></i>
                    <div class="ca-content">
                        <h4 class="ca-main one">@assignedSubTickets.Count</h4>
                        <h3 class="ca-sub">My Tickets</h3>
                        <h3 class="ca-main one"></h3>
                    </div>
                </a>

            </li>
        }



        @if (User.IsInRole("Admin"))
        {
            <li>
                <a href="@Url.Action("MyIndex", "Projects")">
                    <i class="fa fa-briefcase" aria-hidden="true"></i>
                    <div class="ca-content">
                        <h4 class="ca-main one">@projectshelper.ProjectsMissingRoles().Count</h4>
                        <h3 class="ca-sub one">Unassigned Projects</h3>
                    </div>
                </a>
            </li>

        }

        @if (User.IsInRole("Manager") || User.IsInRole("Developer") || User.IsInRole("Submitter"))
        {

            <li>
                <a href="@Url.Action("MyIndex", "Projects")">
                    <i class="fa fa-briefcase" aria-hidden="true"></i>
                    <div class="ca-content">
                        <h4 class="ca-main one">@currentUser.Projects.Count</h4>
                        <h3 class="ca-sub one">My Projects</h3>
                    </div>
                </a>
            </li>

        }


        <li>
            <a href="@Url.Action("UserIndex", "Admin")">
                <i class="fa fa-user" aria-hidden="true"></i>
                <div class="ca-content">
                    <h4 class="ca-main two">
                    </h4>
                    <h3 class="ca-sub two">Team Members Index</h3>
                </div>
            </a>
        </li>
        @*<li>
            <a href="#">
                <i class="fa fa-tasks" aria-hidden="true"></i>
                <div class="ca-content">
                    <h4 class="ca-main three">49,436</h4>
                    <h3 class="ca-sub three">Old Projects</h3>
                </div>
            </a>
        </li>*@
        @if (User.IsInRole("Submitter"))
        {

            <li>
                <a href="@Url.Action("Create", "Tickets")">
                    <i class="fa fa-clone" aria-hidden="true"></i>
                    <div class="ca-content">
                        <h4 class="ca-main four"></h4>
                        <h3 class="ca-sub four">Create A Ticket</h3>
                    </div>
                </a>
            </li>
        }

        @if (User.IsInRole("Manager") | User.IsInRole("Admin"))
        {

            <li>
                <a href="@Url.Action("Create", "Projects")">
                    <i class="fa fa-clone" aria-hidden="true"></i>
                    <div class="ca-content">
                        <h4 class="ca-main four"></h4>
                        <h3 class="ca-sub four">Create A Project</h3>
                    </div>
                </a>
            </li>
        }

        @if (User.IsInRole("Developer"))
        {

            <li>
                <a href="#">
                    <i class="fa fa-clone" aria-hidden="true"></i>
                    <div class="ca-content">
                        <h4 class="ca-main four"></h4>
                        <h3 class="ca-sub four">My Work Notes</h3>
                    </div>
                </a>
            </li>
        }

        <!--High Charts-->
        <div class="row">
            <div class="col-md-6"
            <div id="tickets-status-high-chart" style="height: 400px"></div>

<!-- //nav -->


        <!-- /agile_top_w3_post_sections-->
        <div class="agile_top_w3_post_sections">
            <div class="col-md-6 agile_top_w3_post agile_info_shadow">
                <div class="img_wthee_post">
                    <h3 class="w3_inner_tittle">Company Overview</h3>
                    <div class="stats-wrap">
                        <div class="count_info"><h4 class="count">65,800,587 </h4><span class="year">Total Administrators</span></div>
                        <div class="year-info"><p class="text-no">20 </p><span class="year">Tickets Today:</span></div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="stats-wrap">
                        <div class="count_info"><h4 class="count">2,690 </h4><span class="year">Total Managers</span></div>
                        <div class="year-info"><p class="text-no">40 </p><span class="year">Tickets This Month</span></div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="stats-wrap">
                        <div class="count_info"><h4 class="count">24,660 </h4><span class="year">Total Developers</span></div>
                        <div class="year-info"><p class="text-no">30 </p><span class="year">Tickets This Week</span></div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="stats-wrap">
                        <div class="count_info"><h4 class="count">1,204</h4><span class="year">Total Submitters</span></div>
                        <div class="year-info"><p class="text-no">10 </p><span class="year">Tickets Today</span></div>
                        <div class="clearfix"></div>
                    </div>

                </div>
            </div>
            @*<div class="col-md-6 agile_top_w3_post_info agile_info_shadow">
                <div class="img_wthee_post1">
                    <h3 class="w3_inner_tittle"> Flip Clock</h3>
                    <div class="main-example">
                        <div class="clock"></div>
                        <div class="message"></div>

                    </div>
                </div>
            </div>*@
        @*</div>*@
            @*<div class="clearfix"></div>

         //agile_top_w3_post_sections
        /prograc-blocks_agileits
    <div class="row"style="display:">
        <div class="prograc-blocks_agileits">
                <div class="col-md-6 bars_agileits agile_info_shadow">
                    <h3 class="w3_inner_tittle two">Projects with Open Tickets</h3>
                    <div class='bar_group'>
                        @foreach (Project proj in projectList)
        {
                        <div class='bar_group__bar thin' label='Bugs Be Gone' show_values='true' tooltip='true' value='15'></div>
                        <div class='bar_group__bar thin' label='Cloud Solution' show_values='true' tooltip='true' value='5'></div>
                        <div class='bar_group__bar thin' label='Financial Portal' show_values='true' tooltip='true' value='550'></div>
                        <div class='bar_group__bar thin' label='Financial Portal Mobile App' show_values='true' tooltip='true' value='456'></div>
                        <div class='bar_group__bar thin' label='School Dashboard' show_values='true' tooltip='true' value='343'></div>
                        <div class='bar_group__bar thin' label='Leadership Dashboard' show_values='true' tooltip='true' value='235'></div>
                        <div class='bar_group__bar thin' label='LKaifer Blog' show_values='true' tooltip='true' value='550'></div>
                        <div class='bar_group__bar thin' label='LKaifer Portfolio' show_values='true' tooltip='true' value='456'></div>
                        <div class='bar_group__bar thin' label='Visitor Check In App' show_values='true' tooltip='true' value='550'></div>
                        <div class='bar_group__bar thin' label='Taekwondo Mobile App' show_values='true' tooltip='true' value='456'></div>

                    </div>
                    </div>
                    </div>
                </div>

    </div>
    </div>*@

            <div class="clearfix"></div>
    </ul>
        </div>
        <!-- //agile_top_w3_grids-->
        <!-- /w3ls_agile_circle_progress-->
        <div class="w3ls_agile_cylinder chart agile_info_shadow">
            <h3 class="w3_inner_tittle two"> Open Tickets Per Project</h3>

            <div id="chartdiv"></div>


        </div>
        <!-- /w3ls_agile_circle_progress-->
        <!-- /chart_agile-->
        <!-- /w3ls_agile_circle_progress-->
        <div class="w3ls_agile_circle_progress agile_info_shadow">

            <div class="cir_agile_info ">
                <h3 class="w3_inner_tittle">Circular Progress</h3>
                <div class="skill-grids">
                    <div class="skills-grid text-center">
                        <div class="circle" id="circles-1"></div>
                        <p>HTML</p>
                    </div>
                    <div class="skills-grid text-center">
                        <div class="circle" id="circles-2"></div>
                        <p>PHOTOGRAPHY</p>
                    </div>
                    <div class="skills-grid text-center">
                        <div class="circle" id="circles-3"></div>

                        <p>ILLUSTRATOR</p>
                    </div>
                    <div class="skills-grid text-center">
                        <div class="circle" id="circles-4"></div>
                        <p>CSS3</p>
                    </div>



                    <div class="clearfix"></div>

                </div>
            </div>
        </div>
        <!-- /w3ls_agile_circle_progress-->
            <div class="col-md-6 fallowers_agile agile_info_shadow">
                <h3 class="w3_inner_tittle two">Recent Followers</h3>
                <div class="work-progres">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Project</th>
                                    <th>Manager</th>

                                    <th>Status</th>
                                    <th>Progress</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Face book</td>
                                    <td>Malorum</td>

                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Twitter</td>
                                    <td>Evan</td>

                                    <td><span class="label label-success">completed</span></td>
                                    <td><span class="badge badge-success">100%</span></td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>Google</td>
                                    <td>John</td>

                                    <td><span class="label label-warning">in progress</span></td>
                                    <td><span class="badge badge-warning">75%</span></td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>LinkedIn</td>
                                    <td>Danial</td>

                                    <td><span class="label label-info">in progress</span></td>
                                    <td><span class="badge badge-info">65%</span></td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td>Tumblr</td>
                                    <td>David</td>

                                    <td><span class="label label-warning">in progress</span></td>
                                    <td><span class="badge badge-danger">95%</span></td>
                                </tr>
                                <tr>
                                    <td>6</td>
                                    <td>Tesla</td>
                                    <td>Mickey</td>

                                    <td><span class="label label-info">in progress</span></td>
                                    <td><span class="badge badge-success">95%</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>

        <!--//prograc-blocks_agileits-->
        <!-- /bottom_agileits_grids-->
        <div class="bottom_agileits_grids">
            <div class="col-md-4 profile-main">
                <div class="profile_bg_agile">
                    <div class="profile-pic wthree">
                        <h2>Bason Durel</h2>
                        <img src="~/images/profile.jpg" alt="Image">
                        <p>Web Designer</p>
                    </div>
                    <div class="profile-ser">
                        <div class="follow-grids-agileits-w3layouts">
                            <div class="profile-ser-grids">
                                <h3>Followers</h3>
                                <h4>2486</h4>
                            </div>
                            <div class="profile-ser-grids agileinfo">
                                <h3>Following</h3>
                                <h4>1582</h4>
                            </div>
                            <div class="profile-ser-grids no-border">
                                <h3>Tweets</h3>
                                <h4>1468</h4>
                            </div>
                            <div class="clearfix"> </div>
                        </div>
                        <div class="w3l_social_icons w3l_social_icons1">
                            <ul>
                                <li><a href="#" class="facebook"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                                <li><a href="#" class="twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                                <li><a href="#" class="google_plus"><i class="fa fa-google-plus" aria-hidden="true"></i></a></li>
                            </ul>
                        </div>

                    </div>
                </div>
            </div>
            <div class="col-md-8 chart_agile agile_info_shadow">
                <h3 class="w3_inner_tittle two">Stacked Bar Chart</h3>
                <div id="chartdiv1"></div>
            </div>


            <div class="clearfix"></div>
        </div>
        <!-- //bottom_agileits_grids-->
        <!-- /weather_w3_agile_info-->
        <div class="weather_w3_agile_info agile_info_shadow">
            <div class="weather_w3_inner_info">

                <div class="over_lay_agile">
                    <h3 class="w3_inner_tittle">Weather Report</h3>
                    <ul>
                        <li>
                            <figure class="icons">
                                <canvas id="partly-cloudy-day" width="60" height="60"></canvas>
                            </figure>
                            <h3>25 °C</h3>
                            <div class="clearfix"></div>
                        </li>
                        <li>
                            <figure class="icons">
                                <canvas id="clear-day" width="60" height="60"></canvas>
                            </figure>
                            <div class="weather-text">
                                <h4>WED</h4>
                                <h5>27 °C</h5>
                            </div>
                            <div class="clearfix"></div>
                        </li>
                        <li>
                            <figure class="icons">
                                <canvas id="snow" width="60" height="60"></canvas>
                            </figure>
                            <div class="weather-text">
                                <h4>THU</h4>
                                <h5>13 °C</h5>
                            </div>
                            <div class="clearfix"></div>
                        </li>
                        <li>
                            <figure class="icons">
                                <canvas id="partly-cloudy-night" width="60" height="60"></canvas>
                            </figure>
                            <div class="weather-text">
                                <h4>FRI</h4>
                                <h5>18 °C</h5>
                            </div>
                            <div class="clearfix"></div>
                        </li>
                        <li>
                            <figure class="icons">
                                <canvas id="cloudy" width="60" height="60"></canvas>
                            </figure>
                            <div class="weather-text">
                                <h4>SAT</h4>
                                <h5>15 °C</h5>
                            </div>
                            <div class="clearfix"></div>
                        </li>
                        <li>
                            <figure class="icons">
                                <canvas id="fog" width="60" height="60"></canvas>
                            </figure>
                            <div class="weather-text">
                                <h4>SUN</h4>
                                <h5>11 °C</h5>
                            </div>
                            <div class="clearfix"></div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- //weather_w3_agile_info-->
        <!-- /social_media-->
        <div class="social_media_w3ls">

            <div class="col-md-3 socail_grid_agile facebook">
                <ul class="icon_w3_info">
                    <li><a href="#" class="wthree_facebook"> <i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                    <li>Facebook</li>
                </ul>
                <ul class="icon_w3_social">
                    <li><i class="fa fa-comment-o" aria-hidden="true"></i></li>
                    <li><i class="fa fa-envelope-o" aria-hidden="true"></i></li>
                    <li><i class="fa fa-user" aria-hidden="true"></i></li>
                </ul>
                <div class="clearfix"></div>
                <div class="bottom_info_social">
                    <div class="col-md-4 agile_w3l_social_media_text_img">
                        <img src="~/images/admin.jpg" alt="">
                    </div>
                    <div class="col-md-8 agile_w3l_social_media_text">
                        <h4>Hurisa Joe</h4>
                        <p>Lorem ipsum dolor sit amet</p>
                    </div>

                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="col-md-3 socail_grid_agile twitter">
                <ul class="icon_w3_info">
                    <li><a href="#" class="wthree_facebook"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                    <li>Twitter</li>
                </ul>
                <ul class="icon_w3_social">
                    <li><i class="fa fa-comment-o" aria-hidden="true"></i></li>
                    <li><i class="fa fa-envelope-o" aria-hidden="true"></i></li>
                    <li><i class="fa fa-user" aria-hidden="true"></i></li>
                </ul>
                <div class="clearfix"></div>
                <div class="bottom_info_social">
                    <div class="col-md-4 agile_w3l_social_media_text_img">
                        <img src="~/images/a1.jpg" alt="">
                    </div>
                    <div class="col-md-8 agile_w3l_social_media_text">
                        <h4>Jasmin Joe</h4>
                        <p>Lorem ipsum dolor sit amet</p>
                    </div>

                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="col-md-3 socail_grid_agile gmail">
                <ul class="icon_w3_info">
                    <li><a href="#" class="wthree_facebook"><i class="fa fa-google-plus" aria-hidden="true"></i></a></li>
                    <li>Google+</li>
                </ul>
                <ul class="icon_w3_social">
                    <li><i class="fa fa-comment-o" aria-hidden="true"></i></li>
                    <li><i class="fa fa-envelope-o" aria-hidden="true"></i></li>
                    <li><i class="fa fa-user" aria-hidden="true"></i></li>
                </ul>
                <div class="clearfix"></div>
                <div class="bottom_info_social">
                    <div class="col-md-4 agile_w3l_social_media_text_img">
                        <img src="~/images/a2.jpg" alt="">
                    </div>
                    <div class="col-md-8 agile_w3l_social_media_text">
                        <h4>John Pal</h4>
                        <p>Lorem ipsum dolor sit amet</p>
                    </div>

                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="col-md-3 socail_grid_agile dribble">

                <ul class="icon_w3_info">
                    <li><a href="#" class="wthree_facebook"><i class="fa fa-dribbble" aria-hidden="true"></i></a></li>
                    <li>Dribbble</li>
                </ul>
                <ul class="icon_w3_social">
                    <li><i class="fa fa-comment-o" aria-hidden="true"></i></li>
                    <li><i class="fa fa-envelope-o" aria-hidden="true"></i></li>
                    <li><i class="fa fa-user" aria-hidden="true"></i></li>
                </ul>
                <div class="clearfix"></div>
                <div class="bottom_info_social">
                    <div class="col-md-4 agile_w3l_social_media_text_img">
                        <img src="~/images/a4.jpg" alt="">
                    </div>
                    <div class="col-md-8 agile_w3l_social_media_text">
                        <h4>Honey Pal</h4>
                        <p>Lorem ipsum dolor sit amet</p>
                    </div>

                    <div class="clearfix"></div>
                </div>

            </div>
            <div class="clearfix"></div>

        </div>
        <!-- //social_media-->
    </div>
    <!-- //inner_content_w3_agile_info-->
</div>
<!-- //inner_content-->
    </div>
<!-- banner -->
<!--copy rights start here-->
@section scripts{
    <script>
        //Ajax Code for 3D Donut Highcharts for Ticket Statuses
        $.ajax({
            url: '@Url.Action("TicketStatusData", "Home")',
            success: function (response) {
                Highchartinitforticketstatuses(response);
            }
        });
        //Data transforming into right format
        function TransformData(data) {
            var result = [];
            $.each(data, function (index, item) {
                var ticketStatusObj = [item.TicketStatusName, Number(item.TicketCount)];
                result.push(ticketStatusObj);
            });
            return result;
        }
        //Highcharts for Ticket Statuses
        function Highchartinitforticketstatuses(data) {
            Highcharts.chart('tickets-status-high-chart', {
                chart: {
                    type: 'pie',
                    options3d: {
                        enabled: true,
                        alpha: 45
                    }
                },
                title: {
                    text: 'Ticket Status Counts'
                },
                subtitle: {
                    text: 'Detail of New, Assigned, In Progress, Completed and Archived'
                },
                plotOptions: {
                    pie: {
                        innerSize: 100,
                        depth: 45
                    }
                },
                series: [{
                    name: 'Tickets Count',
                    data: TransformData(data)
                }]
            });
        }
    </script>
    }